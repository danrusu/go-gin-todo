<!DOCTYPE html>

<html>
    <head>
        <title>TODO APP</title>
		<style>
			#content{
						
			}
			span, input{				
				display: inline-block;
				width: 49%;						
			}
			button, input, label, textarea{								
				margin: 10px;
				padding: 5px;
				width: 150px;
			}
			button, label{
				display: block;
			}
			button:hover{
				background-color: indianred;
				color: white;
			}
			textarea{
				width: 350px;
			}
			input{
				text-align: center;
			}

			.form span{
				display: inline-block;
				width: 100px;
				color: darkblue;
				margin: 10px;
			}

		</style>
    </head>

    <body>
        <h2>Welcome to TODO APP</h2>
		<div id="content">
			<span id="actions">
				
				<label>TODO CONTENT</label>
				<!-- <textarea id="todoBody" rows="8" cols="100">
				</textarea>	 -->
				<div id="form">
					<div>
						<span>Id</span>
						<input type="number" id="todoId" />
					</div>
					<div>
						<span>Name</span>
						<input type="text" id="todoName" />
					</div>
					<div>
						<span>Description</span>
						<input type="text" id="todoDescription" />
					</div>
					<div>
						<span>Project</span>
						<input type="text" id="todoProject" />
					</div>
					<div>
						<span>Date</span>
						<input type="date" id="todoDate" />
					</div>
					<div>
						<span>Time</span>
						<input type="time" id="todoTime" />
					</div>
					<div>
						<span>Priority</span>
						<input type="number" id="todoPriority" />
					</div>
				</div>
				
			
				<button id="getAllTodos">GET ALL</button>
				<button id="getTodo">GET</button>
				<button id="createTodo">CREATE</button>
				<button id="updateTodo">UPDATE</button>
				<button id="deleteTodo">DELETE</button>
				<button id="deleteAllTodos">DELETE ALL</button>
			</span>
			
			<span id="todos">
				
			</span>					
		</div>
    </body>

    <script>			
		const prettify = json => JSON.stringify(json, null, 2);
		const logJson = json => console.log(prettify(json));
		
		const selectById = id => document.getElementById(id);
		const selectAll = cssSelector => [].slice.call(document.querySelectorAll(cssSelector));	
		const setText = (id, text) => selectById(id).innerHTML = text;
		
		// const defaultTodoBody = {   
		// 	name: "Software testing course", 
		// 	description: "Java Selenium Module", 
		// 	project : "SDA",
		// 	date:  "01/03/2020",
		// 	time: "09:00 AM",
		// 	priority: 1
		// };
		// selectById('todoBody').value = JSON.stringify(defaultTodoBody, null, 2);
		// selectById('todoId').value = 0;
		
		const rest = async (url, options) => {
			const response = await fetch(url, options);
			return await response.json();
		}

		const createTodoHtml = todoJson => {
			const noteClass = todoJson.priority == 1 ? 'priority-1-note' 
				:  todoJson.priority == 2 ? 'priority-2-note'
				: 'priority-3-note';

			return '<div clas="' + noteClass + '">'
				+ '<div class="title"' + todoJson.name + '</div>'
				+ '<div class="description">' + todoJson.description + '</div>'
				+ '<div class="date">' + todoJson.date + todoJson.time + '</div>'
				+ '<div class="priority">' + todoJson.priority + '</div>'
				+ '</div>';
		}

		const getTodoJson = () =>
			selectAll('#form input').reduce(
				(todoJson, input) => todoJson = { ...todoJson, [input.id]: input.value }
		);			

		const actions = {
					
			getAllTodos: async () => {
				const responseJson =  await rest(
					'https://go-gin-todo.herokuapp.com/api/todo'
				);			
				logJson(responseJson);
				
				const todos = selectById('todos');
				responseJson.data.map(createTodoHtml).forEach(todoHtml => todos.html = todos.html + todoHtml);

				return responseJson.data;
			},
		
			getTodo: async todoId => {
				const responseJson =  await rest(
					'https://go-gin-todo.herokuapp.com/api/todo/' + todoId
				);			
				logJson(responseJson);
				
				return responseJson.data;
			},
			
			createTodo: async todoJson => {
				const responseJson =  await rest(
					'https://go-gin-todo.herokuapp.com/api/todo',
					{
						method: 'POST',
						headers: { 'Content-Type': 'application/json' },
						body: getJsonTodoFromForm()
					}
				);			
				logJson(responseJson);
				
				return responseJson.data;
			},
			
			updateTodo: async (todoId, todoJson) => {
				const responseJson =  await rest(
					'https://go-gin-todo.herokuapp.com/api/todo/' + todoId,
					{
						method: 'PUT',
						headers: { 'Content-Type': 'application/json' },
						body: getJsonTodoFromForm()						 
					}
				);			
				logJson(responseJson);
				
				return responseJson.data;
			},
			
			deleteTodo: async todoId => {
				const responseJson =  await rest(
					'https://go-gin-todo.herokuapp.com/api/todo/' + todoId, 
					{ method: 'DELETE' }
				);			
				logJson(responseJson);
				return responseJson;
			},
			
			deleteAllTodos: async () => {
				const responseJson =  await rest(
					'https://go-gin-todo.herokuapp.com/api/todo/reset',
					{ method: 'POST' }
				);			
				logJson(responseJson);
				return responseJson;
			}		
		};
		
		const addTodoActionToButton = buttonElement => { 
			console.log(todo[button.id]);
			buttonElement.addEventListener('click', todo[button.id]);
		}
			
		const getTodoJsonBody = () => JSON.parse(selectById('todoBody').value);
		const getTodoId = () => selectById('todoId').value;
		

		const buttonsClickEventHandlers = {
			getAllTodos: actions.getAllTodos,
			getTodo: () => actions.getTodo(getTodoId()),
			createTodo: () => actions.createTodo(getTodoJson()),
			updateTodo: () => actions.updateTodo(getTodoId(), getTodoJson()),
			deleteTodo: () => actions.deleteTodo(getTodoId()),
			deleteAllTodos: actions.deleteAllTodos
		}
			
		const bindButtonsActionClickHandlers = () => selectAll('#actions button')
			.forEach(button => button.addEventListener(
				'click', 
				buttonsClickEventHandlers[button.id]
			)				
		);
		
		bindButtonsActionClickHandlers();
		
    </script>

</html>