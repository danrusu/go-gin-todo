<!DOCTYPE html>

<html>
    <head>
        <title>TODO APP</title>
		<style>
			#content{
				text-align: center;
				border: 2px solid black;
			}
			span{				
				display: inline-block;
				width: 49%;				
				margin 0 auto;				
			}
			button{
				display: block;
			}
		</style>
    </head>

    <body>
        <h2>Welcome to TODO APP</h2>
		<div id="content">
			<span id="actions">
				<button id="getAllTodos">GET ALL</button>
				<button id="getTodo">GET</button>
				<button id="createTodo">CREATE</button>
				<button id="updateTodo">UPDATE</button>
				<button id="deleteTodo">DELETE</button>
				<button id="deleteAllTodos">DELETE ALL</button>
			</span>
			
			<span id="todos">
				
			</span>					
		</div>
    </body>

    <script>
		const prettify = json => JSON.stringify(json, null, 2);
		const logJson = json => console.log(prettify(json));
		
		const selectById = id => document.getElementById(id);
		const selectAll = cssSelector => [].slice.call(document.querySelectorAll(cssSelector));
		const setText = (id, text) => selectById(id).innerHTML = text;
		
		const rest = async (url, options) => {
			const response = await fetch(url, options);
			return await response.json();
		}
							
		const todo = {
		
			getAllTodos: async () => {
				const responseJson =  await rest(
					'https://go-gin-todo.herokuapp.com/api/todo'
				);			
				logJson(responseJson);
				
				return responseJson.data;
			},
		
			getTodo: async todoId => {
				const responseJson =  await rest(
					`https://go-gin-todo.herokuapp.com/api/todo/${todoId}`
				);			
				logJson(responseJson);
				
				return responseJson.data;
			},
			
			createTodo: async todoJson => {
				const responseJson =  await rest(
					'https://go-gin-todo.herokuapp.com/api/todo',
					{
						method: 'POST',
						headers: { 'Content-Type': 'application/json' },
						data: JSON.stringify(todoJson)						 
					}
				);			
				logJson(responseJson);
				
				return responseJson.data;
			},
			
			updateTodo: async (todoId, todoJson) => {
				const responseJson =  await rest(
					`https://go-gin-todo.herokuapp.com/api/todo/${todoId}`,
					{
						method: 'PUT',
						headers: { 'Content-Type': 'application/json' },
						data: JSON.stringify(todoJson)						 
					}
				);			
				logJson(responseJson);
				
				return responseJson.data;
			},
			
			deleteTodo: async todoId => {
				const responseJson =  await rest(
					`https://go-gin-todo.herokuapp.com/api/todo/${todoId}`, 
					{ method: 'DELETE' }
				);			
				logJson(responseJson);
				return responseJson;
			},
			
			deleteAllTodos: async () => {
				const responseJson =  await rest(
					'https://go-gin-todo.herokuapp.com/api/todo/reset',
					{ method: 'POST' }
				);			
				logJson(responseJson);
				return responseJson;
			}		
		};
		
		const addTodoActionToButton = buttonElement => { 
			console.log(todo[button.id]);
			buttonElement.addEventListener('click', todo[button.id]);
		}
			
		const bindButtonsActionClick = () => {
			const getAllTodosButton = selectById('getAllTodos');
			getAllTodosButton.addEventListener('click', todo['getAllTodos']);
			
			const getTodoButton = selectById('getTodo');
			getTodoButton.addEventListener('click', () => todo['getTodo'](0));
			
			const createTodoButton = selectById('createTodo');
			createTodoButton.addEventListener('click', () => todo['createTodo'](
				{				
					"name": "Software testing course", 
					"description": "Java Selenium Module", 
					"project" : "SDA",
					"date":  "01/03/2020",
					"time": "09:00 AM",
					"priority": 1
				}
			));
			
			const updateTodoButton = selectById('updateTodo');
			updateTodoButton.addEventListener('click', () => todo['updateTodo'](
				0, 
				{
					"name": "Software testing course", 
					"description": "Java Selenium Module", 
					"project" : "SDA",
					"date":  "02/03/2020",
					"time": "1:00 PM",
					"priority": 2
				}
			));
			
			const deleteTodoButton = selectById('deleteTodo');
			deleteTodoButton.addEventListener('click', () => todo['deleteTodo'](0));
			
			const deleteAllTodosButton = selectById('deleteAllTodos');
			deleteAllTodosButton.addEventListener('click', todo['deleteAllTodos']);
			
		}
		
		bindButtonsActionClick();
		
    </script>

</html>